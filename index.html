<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sushi Fox</title>
<link rel="icon" href="images/favicon.png" type="image/x-icon" />
<style>
:root{
  --bg:#fff5f9;--primary:#ff5ea8;--primary-2:#ff66cc;
  --text:#222;--muted:#666;--card:#ffffff;
  --shadow:0 8px 20px rgba(0,0,0,.08);--radius:16px;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;
  background:radial-gradient(1200px 600px at -10% -10%, #ffe4f2 0%, transparent 60%),
             radial-gradient(1200px 700px at 110% -15%, #e0f4ff 0%, transparent 55%),
             var(--bg);color:var(--text);min-height:100dvh;}
.container{max-width:1100px;margin:0 auto;padding:20px}
.header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:18px}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:48px;height:48px;border-radius:50%;background:url('images/323231231.png') no-repeat center/cover;box-shadow:var(--shadow);}
h1{margin:0;font-size:26px;letter-spacing:.5px}
.subtitle{font-size:13px;color:var(--muted)}
.tabs{display:flex;flex-wrap:wrap;gap:10px;margin:18px 0 14px}
.tab{padding:10px 16px;border-radius:999px;cursor:pointer;background:#f1f1f1;font-weight:600;transition:.25s;box-shadow:0 2px 6px rgba(0,0,0,.04)}
.tab:hover{transform:translateY(-1px)}
.tab.active{background:linear-gradient(120deg,var(--primary),var(--primary-2));color:#fff;box-shadow:var(--shadow)}
.section{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;}
.products{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-top:14px}
@media(max-width:980px){.products{grid-template-columns:repeat(3,1fr)}}
@media(max-width:720px){.products{grid-template-columns:repeat(2,1fr)}}
@media(max-width:430px){.products{grid-template-columns:repeat(2,1fr)}}
.card{background:#fff;border-radius:14px;box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column;transition:.25s}
.card:hover{transform:translateY(-2px)}
.card-img{width:100%;aspect-ratio:4/3;object-fit:cover}
.card-body{padding:10px 12px 12px;text-align:left}
.card-title{font-weight:700;margin:0 0 4px}
.card-desc{font-size:13px;color:var(--muted);line-height:1.35;min-height:34px}
.card-row{display:flex;align-items:center;justify-content:space-between;margin-top:8px}
.price{color:var(--primary);font-weight:800}
.btn{padding:8px 12px;border:none;border-radius:10px;cursor:pointer;font-weight:700;
  background:linear-gradient(120deg,var(--primary),var(--primary-2));color:#fff;transition:.25s}
.btn:hover{filter:brightness(.95);transform:translateY(-1px)}
.cart-fab{position:fixed;right:18px;bottom:18px;width:60px;height:60px;border-radius:50%;
  display:grid;place-items:center;background:linear-gradient(120deg,var(--primary),var(--primary-2));
  color:#fff;font-size:20px;font-weight-800;cursor:pointer;box-shadow:var(--shadow);z-index:50}
.cart-count{position:absolute;top:-6px;right:-6px;background:#000;color:#fff;border-radius:999px;font-size:12px;padding:2px 6px;font-weight:800}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:60;padding:10px}
.modal.open{display:flex}
.sheet{width:min(900px,100%);max-height:92dvh;overflow:auto;background:#fff;border-radius:18px;box-shadow:var(--shadow);padding:14px;position:relative;}
.sheet h3{margin:4px 0 10px}
.sheet-grid{display:grid;grid-template-columns:1fr 320px;gap:14px}
@media(max-width:860px){.sheet-grid{grid-template-columns:1fr}}
.cart-list{display:flex;flex-direction:column;gap:10px}
.cart-item{display:grid;grid-template-columns:60px 1fr auto auto auto;gap:10px;align-items:center;background:#fafafa;border-radius:12px;padding:8px}
.cart-item img{Width:60px;height:60px;object-fit:cover;border-radius:10px}
.qty{display:flex;align-items:center;gap:6px}
.icon-btn{width:28px;height:28px;border-radius:8px;border:none;cursor:pointer;background:#f0f0f0;font-weight:800}
.remove{background:#fff0f3;border:1px solid #ffd4e3;color:#c21c59}
.summary{background:#fafafa;border-radius:14px;padding:12px;display:flex;flex-direction:column;gap:10px}
.input{width:100%;padding:10px;border-radius:10px;border:1px solid #e8e8e8}
.total{display:flex;align-items:center;justify-content:space-between;font-weight:800}
.close-x{position:absolute;right:14px;top:10px;font-size:22px;cursor:pointer}
.footer{margin:22px 0 40px;display:grid;grid-template-columns:1fr 1fr;gap:16px}
@media(max-width:860px){.footer{grid-template-columns:1fr}}
.contact-card{background:#fff;border-radius:16px;box-shadow:var(--shadow);padding:14px;text-align:left}
.contact-row{display:flex;gap:8px;align-items:center;margin:6px 0;color:var(--muted)}
.map{overflow:hidden;border-radius:16px;box-shadow:var(--shadow);min-height:260px}
a.link{color:var(--primary);text-decoration:none;font-weight:700}
a.link:hover{text-decoration:underline}
.slider-container { position: relative; overflow: hidden; border-radius: var(--radius); height: 250px; max-width: 400px; margin: 0 auto; }
@media(max-width:720px){.slider-container {max-width: 90%;}}
.slide {display: none; width:100%; height:100%;}
.slide.active {display:block;}
.slide img {width:100%; height:100%; object-fit:cover; border-radius: var(--radius);}
.prev, .next { cursor: pointer; position: absolute; top: 50%; padding: 12px; margin-top: -22px; color: #fff; font-weight: 800; font-size: 22px; border-radius: 0 3px 3px 0; user-select: none; background: rgba(0,0,0,.3);}
.next {right:0;border-radius:3px 0 0 3px;}
.prev:hover, .next:hover {background: rgba(0,0,0,.6);}
#thumbs img {height:60px;border-radius:10px;cursor:pointer;opacity:.6;transition:.3s;}
#thumbs img.active {opacity:1;box-shadow:0 0 0 2px var(--primary);}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>Sushi Fox –º–µ–Ω—é</h1>
        <div class="subtitle">–î–æ—Å—Ç–∞–≤–∫–∞ –≤–∫—É—Å–Ω–æ–≥–æ ‚Äî –ø–∏—Ü—Ü–∞, —Å—É—à–∏, –Ω–∞–ø–∏—Ç–∫–∏ –∏ —Å–∞–ª–∞—Ç—ã</div>
      </div>
    </div>
  </div>

  <div class="tabs" id="tabs"></div>

  <div class="section">
    <div id="slider" class="slider-container"></div>
    <div id="thumbs" style="display:flex;gap:6px;margin-top:6px;"></div>
  </div>

  <div class="section">
    <div id="products" class="products"></div>
  </div>

  <div class="footer">
    <div class="contact-card">
      <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
      <div class="contact-row">üìû –¢–µ–ª–µ—Ñ–æ–Ω: <a class="link" href="tel:+380000000000">+38 (000) 000-00-00</a></div>
      <div class="contact-row">üïò –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: 10:00 ‚Äî 22:00</div>
      <div class="contact-row">üìç –ê–¥—Ä–µ—Å: –í–æ–ª—å–Ω–æ–≥–æ—Ä—Å–∫, –±—É–ª—å–≤–∞—Ä –º–∏—Ä–∞ —É–ª–∏—Ü–∞ 15</div>
      <div class="contact-row">üì∏ Instagram: <a class="link" href="https://www.instagram.com/vice_city_bar_volnohorsk/" target="_blank">@vice_city_bar_volnohorsk</a></div>
      <div class="contact-row">‚úàÔ∏è Telegram: <a class="link" href="https://t.me/morphlindance0" target="_blank">@morphlindance0</a></div>
    </div>
    <div class="map">
      <iframe src="https://www.google.com/maps/embed?pb=!1m18..." width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
    </div>
  </div>
</div>

<div class="cart-fab" id="openCart" title="–ö–æ—Ä–∑–∏–Ω–∞">üõí<div class="cart-count" id="cartCount">0</div></div>
<div class="modal" id="cartModal">
  <div class="sheet">
    <div class="close-x" id="closeCart">‚úï</div>
    <h3>–í–∞—à –∑–∞–∫–∞–∑</h3>
    <div class="sheet-grid">
      <div><div id="cartList" class="cart-list"></div></div>
      <div class="summary">
        <input id="custName" class="input" placeholder="–í–∞—à–µ –∏–º—è"/>
        <input id="custPhone" class="input" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω"/>
        <input id="custAddr" class="input" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏"/>
        <textarea id="custNote" class="input" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" rows="3"></textarea>
        <div style="display:flex;gap:8px;margin-top:6px">
          <label style="flex:1"><input type="radio" name="payment" value="wayforpay" checked> –û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π</label>
          <label style="flex:1"><input type="radio" name="payment" value="cash"> –û–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏</label>
        </div>
        <button id="checkoutOrder" class="btn" style="margin-top:6px;width:100%">–ó–∞–∫–∞–∑–∞—Ç—å</button>
        <div id="orderResult" style="margin-top:8px;font-weight:700"></div>
        <div class="total" style="margin-top:10px"><span>–ò—Ç–æ–≥–æ</span><span id="cartTotal">0‚Ç¥</span></div>
      </div>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, collection, getDocs, query, where, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAYXF7iVTnHIB67DAcoxA5dbhNSEcKrNkA",
  authDomain: "sushi-fox-menu.firebaseapp.com",
  projectId: "sushi-fox-menu",
  storageBucket: "sushi-fox-menu.appspot.com",
  messagingSenderId: "520117298113",
  appId: "1:520117298113:web:608a831f6bbe1e914e0540"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* –°–õ–ê–ô–î–ï–† */
let slideIndexMap = {}, sliderInterval = null, activeCategory = null;
function renderSlider(category, products) {
  activeCategory = category;
  const sliderEl = document.getElementById('slider');
  const thumbsEl = document.getElementById('thumbs');
  sliderEl.innerHTML = '';
  thumbsEl.innerHTML = '';
  if(!products.length) return;
  products.forEach((p,i)=>{
    const slide=document.createElement('div');
    slide.className='slide'+(i===0?' active':'');
    slide.innerHTML=`<img src="${p.img}"/>`;
    sliderEl.appendChild(slide);
    const thumb=document.createElement('img');
    thumb.src=p.img; if(i===0) thumb.classList.add('active');
    thumb.onclick=()=>{ showSlide(i, category); resetInterval(category, products.length); };
    thumbsEl.appendChild(thumb);
  });
  slideIndexMap[category]=0;
  resetInterval(category, products.length);
}
function showSlide(n, category){
  const slides=document.querySelectorAll('.slide');
  const thumbs=document.querySelectorAll('#thumbs img');
  slides.forEach(s=>s.classList.remove('active'));
  thumbs.forEach(t=>t.classList.remove('active'));
  slides[n].classList.add('active');
  thumbs[n].classList.add('active');
  slideIndexMap[category]=n;
}
function nextSlide(category,len){
  let idx=slideIndexMap[category]??0;
  idx=(idx+1)%len;
  showSlide(idx,category);
}
function resetInterval(category,len){
  if(sliderInterval) clearInterval(sliderInterval);
  sliderInterval=setInterval(()=>nextSlide(category,len),4000);
}

/* –ö–ê–¢–ï–ì–û–†–ò–ò –ò –¢–û–í–ê–†–´ */
async function loadCategories(){
  const snapshot = await getDocs(collection(db,"products"));
  const all = snapshot.docs.map(doc=>doc.data());
  const categories=[...new Set(all.map(p=>p.category))];
  const tabsEl=document.getElementById('tabs'); tabsEl.innerHTML='';
  categories.forEach(cat=>{
    const t=document.createElement('div'); t.className='tab'; t.textContent=cat;
    t.onclick=()=>showTab(cat); tabsEl.appendChild(t);
  });
  if(categories.length) showTab(categories[0]);
}
async function showTab(category){
  document.querySelectorAll('.tab').forEach(el=>el.classList.toggle('active',el.textContent===category));
  const q=query(collection(db,"products"),where("category","==",category));
  const snapshot=await getDocs(q);
  const products=snapshot.docs.map(doc=>doc.data());
  renderSlider(category,products);
  const prodEl=document.getElementById('products'); prodEl.innerHTML='';
  products.forEach(p=>{
    const c=document.createElement('div'); c.className='card';
    c.innerHTML=`<img src="${p.img}" class="card-img"/><div class="card-body"><div class="card-title">${p.name}</div><div class="card-desc">${p.desc}</div><div class="card-row"><div class="price">${p.price}‚Ç¥</div><button class="btn">–í –∫–æ—Ä–∑–∏–Ω—É</button></div></div>`;
    c.querySelector('.btn').onclick=()=>addToCart(p);
    prodEl.appendChild(c);
  });
}

/* –ö–û–†–ó–ò–ù–ê */
let cart=[];
function addToCart(item){const f=cart.find(c=>c.name===item.name); f?f.qty++:cart.push({...item,qty:1});updateCart();}
function updateCart(){const listEl=document.getElementById('cartList'); listEl.innerHTML=''; cart.forEach((c,i)=>{
  const div=document.createElement('div'); div.className='cart-item';
  div.innerHTML=`<img src="${c.img}"/><div>${c.name}</div><div class="qty"><button class="icon-btn" onclick="changeQty(${i},-1)">-</button><span>${c.qty}</span><button class="icon-btn" onclick="changeQty(${i},1)">+</button></div><div class="price">${c.price*c.qty}‚Ç¥</div><button class="icon-btn remove" onclick="removeItem(${i})">‚úï</button>`;
  listEl.appendChild(div);
});
const total=cart.reduce((a,c)=>a+c.price*c.qty,0);
document.getElementById('cartTotal').textContent=total+'‚Ç¥';
document.getElementById('cartCount').textContent=cart.reduce((a,c)=>a+c.qty,0);}
window.changeQty=(i,n)=>{cart[i].qty+=n;if(cart[i].qty<1)cart.splice(i,1);updateCart();}
window.removeItem=(i)=>{cart.splice(i,1);updateCart();}
document.getElementById('openCart').onclick=()=>document.getElementById('cartModal').classList.add('open');
document.getElementById('closeCart').onclick=()=>document.getElementById('cartModal').classList.remove('open');

/* –û–§–û–†–ú–õ–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê */
document.getElementById('checkoutOrder').onclick = async () => {
  if(!cart.length){ alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞'); return;}
  const name=document.getElementById('custName').value.trim();
  const phone=document.getElementById('custPhone').value.trim();
  const addr=document.getElementById('custAddr').value.trim();
  const note=document.getElementById('custNote').value.trim();
  if(!name){alert('–£–∫–∞–∂–∏—Ç–µ –∏–º—è'); return;}
  if(!phone){alert('–£–∫–∞–∂–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω'); return;}
  const total=cart.reduce((a,c)=>a+c.price*c.qty,0);
  const paymentMethod=document.querySelector('input[name="payment"]:checked').value;
  const orderNumber=Date.now();

  if(paymentMethod==='cash'){
    try{
      await addDoc(collection(db,'orders'),{
        orderNumber,
        items:cart.map(c=>({name:c.name,qty:c.qty,price:c.price})),
        total,
        customer:{name,phone,addr,note},
        paymentMethod,
        status:"new",
        createdAt:serverTimestamp()
      });
    }catch(err){console.error(err);alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞'); return;}
    document.getElementById('orderResult').textContent=`–í–∞—à –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç! –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞: #${orderNumber}`;
    cart=[]; updateCart();
    setTimeout(()=>document.getElementById('cartModal').classList.remove('open'),3000);
    return;
  }

  // –û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π —á–µ—Ä–µ–∑ WayForPay
  try{
    const res=await fetch('/.netlify/functions/create-order',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({amount:total,products:cart.map(c=>({name:c.name,price:c.price,qty:c.qty}))})
    });
    if(!res.ok) throw new Error('Create-order failed');
    const data=await res.json();
    if(!data.merchantSignature){alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞'); console.error(data); return;}
    const form=document.createElement('form');
    form.action='https://secure.wayforpay.com/pay';
    form.method='POST'; form.style.display='none';
    for(const [key,value] of Object.entries(data)){
      const input=document.createElement('input'); input.type='hidden';
      input.name=key; input.value=Array.isArray(value)?value.join(';'):value;
      form.appendChild(input);
    }
    document.body.appendChild(form); form.submit(); document.body.removeChild(form);
  }catch(e){console.error(e); alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–ø–ª–∞—Ç—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WayForPay / Netlify Function.'); return;}
};

/* –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø */
loadCategories();
</script>
</body>
</html>