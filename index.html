<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sushi Fox ‚Äî –º–µ–Ω—é</title>
<link rel="icon" href="images/favicon.png" type="image/x-icon" />
<style>
:root{
  --bg:#2a2a2a;
  --accent:#ff9900;   /* –ø–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π ‚Äî –¥–ª—è —Ü—ñ–Ω —Ç–∞ –æ–ø–∏—Å—ñ–≤ */
  --muted:#98a0aa;
  --radius:14px;
  --shadow:0 12px 30px rgba(2,6,23,.45);
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:radial-gradient(900px 400px at -10% -10%, #ffeef6 0%, transparent 0%), radial-gradient(900px 500px at 110% -10%, #e8f7ff 0%, transparent 0%), var(--bg); color:#e6eef6; min-height:100dvh; -webkit-font-smoothing:antialiased;}
.container{max-width:1100px;margin:0 auto;padding:20px}
.header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
.logo{width:56px;height:56px;border-radius:12px;background:url('images/323231231.png') center/cover no-repeat;box-shadow:var(--shadow)}
h1{margin:0;font-size:22px;color:var(--accent)}
.subtitle{color:var(--muted);font-size:13px}
.tabs{display:flex;gap:10px;flex-wrap:wrap;margin:18px 0}
.tab{padding:10px 14px;border-radius:999px;background:#fff;font-weight:600;color:#111;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,.08)}
.tab.active{background:linear-gradient(120deg,var(--accent),#ffb347);color:#fff}
.section{background:transparent;border-radius:var(--radius)}

/* Slider */
.slider-container{max-width:420px;margin:0 auto;border-radius:var(--radius);overflow:hidden;background:#fff;box-shadow:var(--shadow)}
.slide{display:none}
.slide.active{display:block}
.slide img{width:100%;height:260px;object-fit:cover;display:block}
.thumbs-row{display:flex;align-items:center;gap:8px;margin-top:8px;justify-content:center;padding:8px}
#thumbs{display:flex;gap:6px;overflow:hidden}
#thumbs img{height:60px;width:100px;object-fit:cover;border-radius:10px;opacity:.65;cursor:pointer;transition:all .18s}
#thumbs img.active{opacity:1;box-shadow:0 0 0 3px rgba(255,153,0,.12);transform:translateY(-2px)}

/* Products grid */
.products{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-top:14px}
@media(max-width:980px){.products{grid-template-columns:repeat(3,1fr)}}
@media(max-width:720px){.products{grid-template-columns:repeat(2,1fr)}}
@media(max-width:460px){.products{grid-template-columns:repeat(1,1fr)}}

/* –ö–∞—Ä—Ç–æ—á–∫–∏: —Ç–µ–ø–µ—Ä—å –±–µ–ª—ã–µ —Ñ–æ–Ω */
.card{
  background:#fff; /* –±–µ–ª—ã–π —Ñ–æ–Ω –∫–∞—Ä—Ç–æ—á–∫–∏ */
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 10px 30px rgba(2,6,23,.06);
  display:flex;
  flex-direction:column;
  transition:transform .18s;
}
.card:hover{transform:translateY(-6px)}
.card-img{width:100%;height:160px;object-fit:cover;cursor:pointer}
.card-body{padding:12px;display:flex;flex-direction:column;gap:8px}
.card-title{font-weight:700;color:#0b1220}
.card-desc{font-size:13px;color:var(--accent);min-height:36px} /* –û–ø–∏—Å ‚Äî –ø–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π */
.card-row{display:flex;align-items:center;justify-content:space-between;gap:8px}
.price{font-weight:700;color:var(--accent)} /* –¶—ñ–Ω–∞ ‚Äî –ø–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π */

/* Buttons */
.btn{background:linear-gradient(120deg,var(--accent),#ffb347);color:#fff;padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
.btn:active{transform:translateY(1px)}

/* Cart FAB */
.cart-fab{position:fixed;right:18px;bottom:18px;width:64px;height:64px;border-radius:18px;background:linear-gradient(120deg,var(--accent),#ffb347);display:grid;place-items:center;color:#fff;font-weight:800;font-size:22px;cursor:pointer;box-shadow:var(--shadow);z-index:60}
.cart-count{position:absolute;top:-6px;right:-6px;background:#071023;color:#fff;border-radius:999px;padding:3px 7px;font-size:12px}

/* Modal / sheet */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,.45);z-index:80;padding:16px}
.modal.open{display:flex}
.sheet{width:min(980px,100%);max-height:92vh;overflow:auto;background:#fff;border-radius:14px;padding:12px;box-shadow:0 30px 60px rgba(2,6,23,.3);position:relative}
.close-x{position:absolute;right:12px;top:10px;cursor:pointer;font-size:20px}
.sheet-grid{display:grid;grid-template-columns:1fr 340px;gap:12px}
@media(max-width:900px){.sheet-grid{grid-template-columns:1fr}}
.cart-list{display:flex;flex-direction:column;gap:10px;padding:6px}
.cart-item{display:grid;grid-template-columns:72px 1fr auto;gap:10px;align-items:center;background:#fbfbfb;padding:8px;border-radius:10px}
.cart-item img{width:72px;height:72px;object-fit:cover;border-radius:8px}

/* Cart text classes (used in JS rendering) */
.cart-name{font-weight:700;color:var(--accent)}
.cart-qty{color:var(--muted)}
.cart-total{font-weight:700;color:var(--accent)}

.qty{display:flex;align-items:center;gap:6px}
.icon-btn{padding:6px;border-radius:8px;border:none;background:#f0f0f0;cursor:pointer}
.summary{background:#fafafa;border-radius:10px;padding:12px;display:flex;flex-direction:column;gap:10px}
.input{width:100%;padding:10px;border-radius:8px;border:1px solid #e7e7e7}

/* Mini lightbox (clone) */
#miniLightboxImg{position:fixed;border-radius:12px;box-shadow:0 20px 50px rgba(2,6,23,.5);cursor:pointer;transition:transform .35s ease, opacity .2s ease;will-change:transform;z-index:200;display:none}

/* -----------------------------
   –¢–æ—á–µ—á–Ω—ã–µ –ø—Ä–∞–≤–∫–∏: —Å–¥–µ–ª–∞—Ç—å —Ç–µ–∫—Å—Ç –≤ –∫–æ—Ä–∑–∏–Ω–µ —á—ë—Ä–Ω—ã–º
   (–Ω–µ –º–µ–Ω—è–µ–º –Ω–∏—á–µ–≥–æ –ª–∏—à–Ω–µ–≥–æ)
   ----------------------------- */

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥–∞–ª–∫–∏ "–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è" */
.sheet h3 {
  color: #000 !important;
}

/* –ú–µ—Ç–∫–∏ –æ–ø–ª–∞—Ç—ã (label —Ä—è–¥–æ–º —Å —Ä–∞–¥–∏–æ) */
.sheet label {
  color: #000 !important;
  font-weight: 600;
}

/* –¢–µ–∫—Å—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞/–æ—à–∏–±–∫–∏ (id orderResult) */
#orderResult {
  color: #000 !important;
  font-weight: 700;
}

/* –¢–µ–∫—Å—Ç "–†–∞–∑–æ–º" –∏ —Å—É–º–º–∞ –≤ –ø—Ä–∞–≤–æ–π –∫–æ–ª–æ–Ω–∫–µ */
.sheet .total,
.sheet .total span,
#cartTotal {
  color: #000 !important;
  font-weight: 800;
}

/* –≠–ª–µ–º–µ–Ω—Ç—ã –≤ —Å–ø–∏—Å–∫–µ –∫–æ—Ä–∑–∏–Ω—ã: –Ω–∞–∑–≤–∞–Ω–∏–µ, qty –∏ –∏—Ç–æ–≥ */
#cartList .cart-name,
#cartList .cart-qty,
#cartList .cart-total,
.cart-total,
.cart-name {
  color: #000 !important;
}

/* –ö–Ω–æ–ø–∫–∏ +/- –∏ –∫—Ä–µ—Å—Ç–∏–∫ –æ—Å—Ç–∞–≤–ª—è–µ–º –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–Ω–µ —Ç—Ä–æ–≥–∞–µ–º) */

</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div style="display:flex;align-items:center;gap:12px">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Sushi Fox</h1>
        <div class="subtitle">–î–æ—Å—Ç–∞–≤–∫–∞: –ø—ñ—Ü–∞, —Å—É—à—ñ, –Ω–∞–ø–æ—ó, —Å–∞–ª–∞—Ç–∏</div>
      </div>
    </div>
  </div>

  <div id="tabs" class="tabs" aria-label="–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó"></div>

  <div class="section">
    <div class="slider-container" id="sliderBlock">
      <div id="slider"></div>
      <div class="thumbs-row">
        <button id="thumbPrev" class="btn" style="padding:6px 10px;margin-right:6px">‚óÄ</button>
        <div id="thumbs"></div>
        <button id="thumbNext" class="btn" style="padding:6px 10px;margin-left:6px">‚ñ∂</button>
      </div>
    </div>
  </div>

  <div class="section">
    <div id="products" class="products" aria-live="polite"></div>
  </div>

<style>
/* –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –∫–∞—Ä—Ç–∞ */
.contacts{
  margin-top:40px;
  background:#2a2a2a;
  border-radius:14px;
  padding:20px;
  box-shadow:var(--shadow);
  color:var(--accent); /* üëà —Ç–µ–ø–µ—Ä—å —Ç–µ–∫—Å—Ç –æ—Ä–∞–Ω–∂–µ–≤—ã–π */
  display:flex;
  flex-wrap:wrap;
  gap:20px;
}
.contact-info{
  flex:1;
  min-width:240px;
}
.contact-row{margin:6px 0;font-size:15px}
.contact-row a.link{color:var(--accent);font-weight:600;text-decoration:none}
.map{
  flex:1.2;
  min-width:300px;
  height:260px;
  border-radius:14px;
  overflow:hidden;
  box-shadow:var(--shadow);
}
</style>

<!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
<div class="contacts">
  <div class="contact-info">
    <h3 style="margin-top:0">–ö–æ–Ω—Ç–∞–∫—Ç–∏</h3>
    <div class="contact-row">üìû –¢–µ–ª–µ—Ñ–æ–Ω: <a class="link" href="tel:+380000000000">+38 (000) 000-00-00</a></div>
    <div class="contact-row">üïò –ß–∞—Å —Ä–æ–±–æ—Ç–∏: 10:00 ‚Äî 22:00</div>
    <div class="contact-row">üìç –ê–¥—Ä–µ—Å–∞: –í–æ–ª—å–Ω–æ–≥–æ—Ä—Å—å–∫, –±—É–ª—å–≤–∞—Ä –ú–∏—Ä—É 15</div>
    <div class="contact-row">üì∏ Instagram: <a class="link" href="https://www.instagram.com/vice_city_bar_volnohorsk/" target="_blank">@vice_city_bar_volnohorsk</a></div>
    <div class="contact-row">‚úàÔ∏è Telegram: <a class="link" href="https://t.me/morphlindance01" target="_blank">@morphlindance01</a></div>
  </div>
  <div class="map">
    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2604.4893619324837!2d34.0087415!3d48.4757868!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x40da4a14a7640001%3A0xf601f29d7836a3b!2z0JvQu9C40L7Qu9C10L3QuNC90LjRgtC10YDQtdC70Yw!5e0!3m2!1suk!2sua!4v1695037185269!5m2!1suk!2sua" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
  </div>
</div>


  <div style="height:28px"></div>
</div>

<!-- Cart FAB -->
<div class="cart-fab" id="openCart" title="–ö–æ—à–∏–∫">üõí<div class="cart-count" id="cartCount">0</div></div>

<!-- Cart Modal -->
<div class="modal" id="cartModal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="sheet">
    <div class="close-x" id="closeCart" title="–ó–∞–∫—Ä–∏—Ç–∏">‚úï</div>
    <h3>–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h3>
    <div class="sheet-grid">
      <div>
        <div id="cartList" class="cart-list"></div>
      </div>
      <div class="summary">
        <input id="custName" class="input" placeholder="–í–∞—à–µ —ñ–º'—è" />
        <input id="custPhone" class="input" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" />
        <input id="custAddr" class="input" placeholder="–ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏" />
        <textarea id="custNote" class="input" placeholder="–ö–æ–º–µ–Ω—Ç–∞—Ä" rows="3"></textarea>

        <div style="display:flex;gap:8px;align-items:center">
          <label style="flex:1"><input type="radio" name="payment" value="online" checked/> –û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–∫–æ—é</label>
          <label style="flex:1"><input type="radio" name="payment" value="cash"/> –û–ø–ª–∞—Ç–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ</label>
        </div>

        <button id="checkoutOrder" class="btn" style="width:100%">–ó–∞–º–æ–≤–∏—Ç–∏</button>
        <div id="orderResult" style="font-weight:700;margin-top:8px"></div>
        <div class="total" style="margin-top:8px;display:flex;justify-content:space-between;font-weight:800">
          <span>–†–∞–∑–æ–º</span><span id="cartTotal">0‚Ç¥</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Mini lightbox clone -->
<img id="miniLightboxImg" alt="" />

<script>
/* ========== –ö–û–ù–§–Ü–ì ========== */
const MENU_API = '/.netlify/functions/menu';
const ORDER_API = '/.netlify/functions/order';
const LIQPAY_API = '/.netlify/functions/liqpay'; // –ª–∏—à–∞—î—Ç—å—Å—è –Ω–∞ –º–∞–π–±—É—Ç–Ω—î, –ø–æ–∫–∏ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è
const IMG_FALLBACK = '/images/noimage.png';

/* ========== –°–¢–ï–ô–¢ ========== */
let allProducts = [];
let categories = [];
let currentCategory = null;
let cart = JSON.parse(localStorage.getItem('sushi_cart') || '[]');

/* ========== –£–¢–ò–õ–Ü–¢–ò ========== */
function formatUAH(n){ return Math.round(n) + '‚Ç¥'; }
function safeImg(url){ return url ? url : IMG_FALLBACK; }
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, (m)=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

/* ========== –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –ú–ï–ù–Æ ========== */
async function loadMenu(){
  try{
    const res = await fetch(MENU_API);
    if(!res.ok) throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –º–µ–Ω—é –∑ —Å–µ—Ä–≤–µ—Ä–∞');
    const data = await res.json();

    if (data?.products && Array.isArray(data.products)) {
      allProducts = data.products;
      categories = Array.isArray(data.categories) && data.categories.length ? data.categories : Array.from(new Set(allProducts.map(p=>p.category || '–Ü–Ω—à–µ')));
    } else {
      allProducts = [];
      categories = [];
      console.warn('menu: –æ—Ç—Ä–∏–º–∞–Ω–æ –ø–æ—Ä–æ–∂–Ω—ñ –¥–∞–Ω—ñ');
    }
    renderCategories();
    if(categories.length) showCategory(categories[0]);
    else document.getElementById('products').innerHTML = '<div style="padding:20px;color:var(--muted)">–ú–µ–Ω—é –ø–æ—Ä–æ–∂–Ω—î</div>';
  } catch(err){
    console.error('loadMenu error', err);
    document.getElementById('products').innerHTML = `<div style="padding:20px;color:var(--muted)">–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –º–µ–Ω—é</div>`;
  }
}

/* ========== –ö–ê–¢–ï–ì–û–†–Ü–á ========== */
function renderCategories(){
  const tabs = document.getElementById('tabs'); tabs.innerHTML='';
  categories.forEach(cat=>{
    const el = document.createElement('div'); el.className='tab'; el.textContent = cat;
    el.onclick = ()=> showCategory(cat);
    tabs.appendChild(el);
  });
}

/* ========== –ü–û–ö–ê–ó –ö–ê–¢–ï–ì–û–†–Ü–á ========== */
function showCategory(cat){
  currentCategory = cat;
  document.querySelectorAll('.tab').forEach(t=> t.classList.toggle('active', t.textContent===cat));
  const prods = allProducts.filter(p => (p.category || '–Ü–Ω—à–µ') === cat);
  renderProducts(prods);
  renderSlider(prods);
}

/* ========== –†–ï–ù–î–ï–† –ü–†–û–î–£–ö–¢–Ü–í ========== */
function renderProducts(products){
  const wrap = document.getElementById('products'); wrap.innerHTML = '';
  if(!products.length){ wrap.innerHTML = '<div style="padding:18px;color:var(--muted)">–ù–µ–º–∞—î —Ç–æ–≤–∞—Ä—ñ–≤ —É —Ü—ñ–π –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</div>'; return; }
  products.forEach(p=>{
    const card = document.createElement('div'); card.className = 'card';
    card.innerHTML = `
      <img loading="lazy" src="${safeImg(p.img)}" alt="${escapeHtml(p.name)}" class="card-img product-img" />
      <div class="card-body">
        <div class="card-title">${escapeHtml(p.name)}</div>
        <div class="card-desc">${escapeHtml(p.product_description || p.desc || '')}</div>
        <div class="card-row">
          <div class="price">${formatUAH(p.price)}</div>
          <button class="btn add-btn">–í –∫–æ—à–∏–∫</button>
        </div>
      </div>`;
    card.querySelector('.add-btn').addEventListener('click', ()=> addToCartFromProduct(p));
    wrap.appendChild(card);
  });
  initProductLightbox();
}

/* ========== –°–õ–ê–ô–î–ï–† (–∑ –º—ñ–Ω—ñ–∞—Ç—é—Ä–∞–º–∏) ========== */
let sliderInterval = null;
function renderSlider(products){
  const slider = document.getElementById('slider');
  const thumbs = document.getElementById('thumbs');
  slider.innerHTML = ''; thumbs.innerHTML = '';
  if(!products.length) return;
  products.forEach((p,i)=>{
    const s = document.createElement('div'); s.className = 'slide' + (i===0 ? ' active' : '');
    s.innerHTML = `<img src="${safeImg(p.img)}" alt="${escapeHtml(p.name)}" />`;
    slider.appendChild(s);
    const t = document.createElement('img'); t.src = safeImg(p.img);
    if(i===0) t.classList.add('active');
    t.addEventListener('click', ()=> showSlide(i));
    thumbs.appendChild(t);
  });
  let idx = 0; if(sliderInterval) clearInterval(sliderInterval);
  sliderInterval = setInterval(()=>{ idx = (idx + 1) % products.length; showSlide(idx); }, 4000);
}
function showSlide(n){
  const slides = document.querySelectorAll('#slider .slide');
  const tbs = document.querySelectorAll('#thumbs img');
  if(!slides.length) return;
  slides.forEach(s=>s.classList.remove('active'));
  tbs.forEach(t=>t.classList.remove('active'));
  if(slides[n]) slides[n].classList.add('active');
  if(tbs[n]) tbs[n].classList.add('active');
}
document.getElementById('thumbPrev').addEventListener('click', ()=> { document.getElementById('thumbs').scrollBy({left:-120,behavior:'smooth'}); });
document.getElementById('thumbNext').addEventListener('click', ()=> { document.getElementById('thumbs').scrollBy({left:120,behavior:'smooth'}); });

/* ========== –ú–Ü–ù–Ü-–õ–ê–ô–¢–ë–û–ö–° ========== */
function initProductLightbox(){
  document.querySelectorAll('.product-img, #slider img').forEach(img=>{
    img.onclick = ()=> openLightbox(img);
  });
}
function openLightbox(imgEl){
  if(window._miniLb){ window._miniLb.close(); }
  const rect = imgEl.getBoundingClientRect();
  const clone = imgEl.cloneNode();
  clone.id = 'miniLightboxImg';
  clone.style.position='fixed'; clone.style.top=rect.top+'px'; clone.style.left=rect.left+'px';
  clone.style.width=rect.width+'px'; clone.style.height=rect.height+'px';
  clone.style.transition='transform .35s ease, top .35s ease, left .35s ease, width .35s ease, height .35s ease, opacity .2s ease';
  clone.style.transformOrigin='center center'; clone.style.borderRadius='12px'; clone.style.zIndex=9999; clone.style.cursor='pointer'; clone.style.objectFit='cover';
  document.body.appendChild(clone);
  const vw=window.innerWidth,vh=window.innerHeight; const maxW=vw*0.9,maxH=vh*0.9;
  const scale=Math.min(1.8,maxW/rect.width,maxH/rect.height);
  const centerX=rect.left+rect.width/2, centerY=rect.top+rect.height/2;
  const dx=(vw/2)-centerX, dy=(vh/2)-centerY;
  requestAnimationFrame(()=>{ clone.style.transform = `translate(${dx}px, ${dy}px) scale(${scale})`; clone.style.display='block'; });
  function close(){ clone.style.transform='translate(0px, 0px) scale(1)'; setTimeout(()=> { if(clone.parentElement) clone.parentElement.removeChild(clone); }, 350); window._miniLb=null; document.removeEventListener('click', outsideHandler); window.removeEventListener('keydown', keyHandler); }
  function outsideHandler(e){ if(e.target !== clone) close(); }
  function keyHandler(e){ if(e.key === 'Escape') close(); }
  clone.addEventListener('click', close);
  setTimeout(()=>document.addEventListener('click', outsideHandler),0);
  window.addEventListener('keydown', keyHandler);
  window._miniLb = { close };
}

/* ========== –ö–û–®–ò–ö ========== */
function addToCartFromProduct(p){
  const id = p.id || p.product_id || p.name;
  const existing = cart.find(c=>c.id === id);
  if(existing) existing.qty++;
  else cart.push({ id, name: p.name, price: Number(p.price)||0, qty:1, img: p.img || IMG_FALLBACK });
  saveCart(); updateCartUI();
}
function saveCart(){ localStorage.setItem('sushi_cart', JSON.stringify(cart)); }
function updateCartUI(){
  const listEl = document.getElementById('cartList'); listEl.innerHTML = '';
  cart.forEach((c,i)=>{
    const div = document.createElement('div'); div.className = 'cart-item';
    div.innerHTML = `<img src="${safeImg(c.img)}" alt="${escapeHtml(c.name)}"/>
      <div>
        <div class="cart-name">${escapeHtml(c.name)}</div>
        <div class="cart-qty">${formatUAH(c.price)} √ó ${c.qty}</div>
      </div>
      <div style="text-align:right">
        <div class="cart-total">${formatUAH(c.price * c.qty)}</div>
        <div style="margin-top:8px">
          <button class="icon-btn" data-idx="${i}" data-op="-1">‚àí</button>
          <button class="icon-btn" data-idx="${i}" data-op="+1">+</button>
          <button class="icon-btn" data-idx="${i}" data-op="remove" style="margin-left:6px">‚úï</button>
        </div>
      </div>`;
    listEl.appendChild(div);
  });

  // –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–Ω–æ–ø–æ–∫
  listEl.querySelectorAll('.icon-btn').forEach(btn=>{
    btn.onclick = (e)=>{
      const idx = Number(btn.getAttribute('data-idx'));
      const op = btn.getAttribute('data-op');
      if(op === 'remove'){ cart.splice(idx,1); }
      else { cart[idx].qty += Number(op); if(cart[idx].qty < 1) cart.splice(idx,1); }
      saveCart(); updateCartUI();
    };
  });

  document.getElementById('cartTotal').textContent = formatUAH(cart.reduce((a,c)=>a+c.price*c.qty,0));
  document.getElementById('cartCount').textContent = cart.reduce((a,c)=>a+c.qty,0);
}

/* –æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ */
document.getElementById('openCart').addEventListener('click', ()=> { document.getElementById('cartModal').classList.add('open'); document.getElementById('cartModal').setAttribute('aria-hidden','false'); });
document.getElementById('closeCart').addEventListener('click', ()=> { document.getElementById('cartModal').classList.remove('open'); document.getElementById('cartModal').setAttribute('aria-hidden','true'); });

/* ========== –û–§–û–†–ú–õ–ï–ù–ù–Ø –ó–ê–ú–û–í–õ–ï–ù–ù–Ø ========== */
document.getElementById('checkoutOrder').addEventListener('click', async ()=>{
  if(cart.length === 0){ alert('–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π'); return; }
  const name = document.getElementById('custName').value.trim();
  const phone = document.getElementById('custPhone').value.trim();
  const addr = document.getElementById('custAddr').value.trim();
  const note = document.getElementById('custNote').value.trim();
  const payment = document.querySelector('input[name="payment"]:checked').value;
  if(!name || !phone){ alert("–í–∫–∞–∂—ñ—Ç—å —ñ–º'—è —Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω"); return; }

  const payload = {
    customer: { name, phone, addr, note },
    items: cart.map(c => ({ id: c.id, qty: c.qty, price: c.price })), // price —É –≥—Ä–∏–≤–Ω—è—Ö ‚Äî order.js –∫–æ–Ω–≤–µ—Ä—Ç—É—î –≤ –∫–æ–ø—ñ–π–∫–∏
    total: cart.reduce((s,x)=> s + x.price * x.qty, 0),
    paymentMethod: payment
  };

  const orderResultEl = document.getElementById('orderResult');
  orderResultEl.textContent = '–ù–∞–¥—Å–∏–ª–∞—î–º–æ...';

  try {
    // 1) —Å—Ç–≤–æ—Ä—é—î–º–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤ Poster (—á–µ—Ä–µ–∑ Netlify Function)
    const res = await fetch(ORDER_API, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    if(!res.ok) throw new Error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ Poster');
    const orderRes = await res.json();
    const orderId = orderRes?.id || orderRes?.orderId || null;

    if(!orderId){
      orderResultEl.textContent = '–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–≤–æ—Ä–µ–Ω–æ –Ω–∞ Poster, –∞–ª–µ –Ω–µ–≤—ñ–¥–æ–º–∏–π ID';
      return;
    }

    // —è–∫—â–æ –≥–æ—Ç—ñ–≤–∫–∞ ‚Äî –≤—ñ–¥—Ä–∞–∑—É –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î–º–æ
    if(payment === 'cash'){
      orderResultEl.textContent = `–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–π–Ω—è—Ç–æ ‚Ññ${orderId}`;
      cart = []; saveCart(); updateCartUI();
      setTimeout(()=>document.getElementById('cartModal').classList.remove('open'),1500);
      return;
    }

    // —è–∫—â–æ –æ–Ω–ª–∞–π–Ω ‚Äî —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞ –æ–ø–ª–∞—Ç–∞, –∞–ª–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤–∂–µ —Å—Ç–≤–æ—Ä–µ–Ω–æ
    orderResultEl.textContent = `–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–≤–æ—Ä–µ–Ω–æ ‚Ññ${orderId}. –û–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç–∞ —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.`;
    cart = []; saveCart(); updateCartUI();

  } catch(err){
    console.error('checkout error', err);
    document.getElementById('orderResult').textContent = '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è';
  }
});

/* ========== –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ========== */
updateCartUI();
loadMenu();
</script>
</body>
</html>
